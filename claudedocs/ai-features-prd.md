# AI 功能产品需求文档 (PRD)

**版本**: 1.0
**创建日期**: 2025-10-10
**作者**: Claude
**状态**: 待开发

---

## 📋 文档概览

本文档定义了个人博客网站的 AI 辅助功能需求，核心理念是"连接碎片，生成洞察"，受《死亡搁浅》的连接哲学启发。

---

## 🎯 产品愿景

打造一个智能内容连接系统，让 AI 自动从碎片化的内容（照片、动态、文章）中发现关联、识别主题、生成洞察，并辅助创作长文章。

### 核心价值主张

- **时间节约**: AI 自动生成周/月回顾文章，减少 80% 写作时间
- **洞察发现**: AI 主动发现用户行为模式和兴趣主题
- **创作辅助**: 基于历史内容的智能续写和写作建议
- **内容连接**: 可视化展示内容之间的关联关系

---

## 👤 用户画像

**主要用户**: 产品经理，个人博客作者

**核心需求**:

- 记录生活、爱好和想法
- 分享给朋友和对自己感兴趣的陌生人
- 不希望系统过于复杂
- 希望利用 AI 加速内容生产

**技术背景**: 熟悉 AI 工具使用，倾向使用成本低廉的 AI 服务（如 DeepSeek）

---

## 🚀 功能需求

### Phase 1: 核心 AI 辅助功能（优先级：P0）

#### 1.1 时间线自动成文

**功能描述**
AI 自动聚合指定时间段内的所有碎片（照片、动态、文章活动记录），生成连贯的回顾文章。

**使用场景**

```
用户操作：
1. 后台选择时间范围（如"上周"、"本月"、自定义日期）
2. 点击"生成回顾文章"按钮
3. AI 分析期间的所有内容并生成草稿
4. 用户审核、编辑后发布
```

**技术实现**

- **API 端点**: `/api/ai/generate-recap`
- **输入参数**:
  ```typescript
  {
    startDate: Date,
    endDate: Date,
    language: "zh" | "en", // 生成文章语言
    includeTypes: ("post" | "moment" | "gallery")[] // 包含哪些内容类型
  }
  ```
- **处理流程**:
  1. 聚合指定时间段的内容（按时间排序）
  2. 发送到 AI 服务（DeepSeek API）进行分析
  3. AI 生成结构化文章（含时间线、主题分类、情感基调）
  4. 返回草稿供用户编辑

**Prompt 模板**

```
你是一个擅长叙事的写作助手。根据以下用户在 {startDate} 到 {endDate} 期间的活动记录，生成一篇连贯的回顾文章。

活动记录：
{aggregated_content}

要求：
1. 识别主要主题和活动类型
2. 按时间线组织叙事
3. 保留原始内容的引用链接
4. 语言风格：{informal/formal}
5. 长度：800-1200 字

输出格式：
# 标题
## 开篇总结
## 时间线叙事
## 洞察与反思
```

**验收标准**

- ✅ 生成的文章包含所有输入的碎片内容
- ✅ 保留原始碎片的链接
- ✅ 文章结构清晰（开头、主体、结尾）
- ✅ 生成时间 < 30 秒

---

#### 1.2 主题发现引擎

**功能描述**
AI 定期扫描用户近期内容，识别重复出现的主题/关键词，并主动建议创作深度文章。

**使用场景**

```
系统行为：
1. 每周日晚 21:00 自动运行分析任务
2. 识别过去 7 天内高频主题（如"建筑"、"旅行"、"技术"）
3. 在后台生成建议通知："你最近频繁提到 X，要不要生成一篇深度文章？"
4. 用户点击"生成"后，AI 聚合相关内容并生成初稿
```

**技术实现**

- **定时任务**: 使用 Vercel Cron Jobs 或外部调度器
- **API 端点**: `/api/ai/discover-themes`
- **算法逻辑**:
  1. 提取近期内容的关键词（TF-IDF 或 AI 提取）
  2. 聚类相似内容
  3. 计算主题权重（频率 × 时间衰减）
  4. 生成建议列表

**Prompt 模板**

```
分析以下用户近期内容，识别 3-5 个重复出现的主题，并为每个主题生成创作建议。

近期内容摘要：
{recent_content_summary}

输出格式（JSON）：
{
  "themes": [
    {
      "topic": "主题名称",
      "frequency": 5,
      "relatedContentIds": ["id1", "id2"],
      "suggestion": "建议生成的文章标题和大纲"
    }
  ]
}
```

**验收标准**

- ✅ 每周定时执行
- ✅ 识别的主题与实际内容匹配度 > 80%
- ✅ 建议列表显示在后台管理面板

---

#### 1.3 内容关系图谱 (Connection Map)

**功能描述**
3D/2D 可视化展示所有内容（文章、照片、动态）之间的关联关系，灵感来自《死亡搁浅》的连接网络。

**使用场景**

```
用户操作：
1. 访问 /connections 页面
2. 看到交互式图谱：
   - 节点 = 每篇内容
   - 连线 = 关联关系（时间、主题、地理位置）
   - 点击节点查看内容详情
   - 沿连线"漫游"相关内容
```

**关联关系类型**
| 关系类型 | 权重 | 计算方式 |
|---------|------|---------|
| 时间相近 | 0.3 | 发布时间差 < 7 天 |
| 主题相似 | 0.4 | 标签/关键词重叠度 |
| 地理接近 | 0.2 | GPS 坐标距离 < 5km |
| 情感相似 | 0.1 | AI 分析情感基调相似度 |

**技术栈**

- **前端**: Three.js（3D）或 D3.js（2D）
- **后端**: `/api/connections` 返回节点和边数据
- **数据结构**:
  ```typescript
  {
    nodes: Array<{
      id: string,
      type: "post" | "moment" | "gallery",
      title: string,
      date: string,
      x?: number, // 可选的预计算坐标
      y?: number,
      z?: number
    }>,
    edges: Array<{
      source: string, // 节点 ID
      target: string,
      weight: number, // 0-1
      type: "time" | "theme" | "location" | "emotion"
    }>
  }
  ```

**验收标准**

- ✅ 图谱加载时间 < 3 秒
- ✅ 支持缩放、拖拽交互
- ✅ 点击节点跳转到内容详情页
- ✅ 移动端响应式适配

---

#### 1.4 AI 智能续写助手

**功能描述**
写作时，AI 分析当前内容并提供续写建议，基于用户历史写作风格和相关内容。

**使用场景**

```
用户操作：
1. 在文章编辑器中写了开头 200 字
2. 点击"AI 续写建议"按钮
3. AI 分析：
   - 检索相关历史内容
   - 提取用户写作风格特征
   - 生成 3 个续写方向选项
4. 用户选择：
   - 接受某个建议（自动插入）
   - 自己继续写
   - 混合使用
```

**技术实现**

- **API 端点**: `/api/ai/suggest-continuation`
- **输入参数**:
  ```typescript
  {
    currentContent: string,
    postId?: string, // 如果是编辑现有文章
    language: "zh" | "en"
  }
  ```

**Prompt 模板**

```
用户正在撰写一篇文章，已写内容如下：

{current_content}

用户的历史写作风格样本：
{user_writing_samples}

相关历史内容：
{related_content}

任务：生成 3 个不同的续写方向（每个 150-200 字），分别侧重于：
1. 故事延续（narrative）
2. 深度分析（analytical）
3. 个人反思（reflective）

输出格式（JSON）：
{
  "suggestions": [
    {
      "type": "narrative",
      "content": "续写内容...",
      "rationale": "选择此方向的原因"
    },
    ...
  ]
}
```

**验收标准**

- ✅ 响应时间 < 10 秒
- ✅ 续写内容风格与用户历史一致
- ✅ 提供明确的方向差异

---

### Phase 2: 定期自动化功能（优先级：P1）

#### 2.1 记忆回溯生成器

**功能描述**
定期自动生成回顾文章（周报、月报、年报），并发送通知供用户审核发布。

**触发规则**
| 频率 | 触发时间 | 生成内容 |
|------|---------|---------|
| 每周 | 周日 21:00 | 本周回顾（过去 7 天） |
| 每月 | 月末最后一天 23:00 | 月度总结 |
| 每年 | 用户生日或 12/31 | 年度回顾 |

**智能分析维度**

1. **活动密度**: 识别活跃日期和沉寂期
2. **情感曲线**: 通过内容分析情绪变化趋势
3. **行为模式**: 发现规律（如"周末更爱摄影"）
4. **里程碑事件**: 识别重要时刻（第一篇文章、100张照片等）

**技术实现**

- **Cron 任务**: 在 AI 服务端部署定时任务
- **通知机制**:
  - 后台生成草稿并标记为 `DRAFT`
  - 发送邮件/通知提醒用户审核
  - 用户可在后台直接编辑并发布

**验收标准**

- ✅ 定时任务准时触发
- ✅ 生成的文章包含分析维度
- ✅ 用户收到通知

---

#### 2.2 碎片智能重组

**功能描述**
针对特定场景（如旅行），自动聚合相关碎片并生成图文并茂的主题文章。

**使用场景**

```
用户操作：
1. 选择日期范围（如 3 天旅行）
2. AI 自动抓取期间的：
   - 所有照片（按时间/地理位置排序）
   - 相关动态
   - 位置信息（如果有 GPS 数据）
3. AI 生成旅行日记：
   - 每日章节（Day 1, Day 2...）
   - 照片插入到对应时间点
   - 保留原始碎片链接
4. 用户审核后发布
```

**特殊处理**

- **照片排序**: 优先按 EXIF 拍摄时间，其次按上传时间
- **地理聚类**: 相近位置的照片归为同一地点
- **图片优化**: 自动选择最佳质量版本（`mediumPath` 优先）

**Prompt 模板**

```
用户进行了一次旅行（{startDate} - {endDate}），请根据以下内容生成旅行日记：

照片列表（含时间和位置）：
{photos_with_metadata}

动态记录：
{moments}

要求：
1. 按日期分章节
2. 每个章节包含：
   - 地点概述
   - 照片描述（引用图片链接）
   - 情感表达
3. 语言风格：轻松、游记式
4. 长度：1500-2000 字

输出格式：Markdown
```

**验收标准**

- ✅ 照片按时间正确排序
- ✅ 文章结构清晰（按日期分段）
- ✅ 所有照片都有引用链接

---

### Phase 3: 高级功能（优先级：P2）

#### 3.1 语义搜索与相似内容推荐

**功能描述**
使用向量化技术实现语义搜索，并在文章底部显示相似内容推荐。

**技术实现**

- **向量化**: 使用 OpenAI Embeddings API 或开源模型（如 Sentence Transformers）
- **存储**: 将向量存储在 `Post.contentVector` 字段（JSONB）
- **相似度计算**: 余弦相似度

**数据库 Schema 变更**

```sql
-- 已在 Phase 1 准备
ALTER TABLE "Post" ADD COLUMN "contentVector" JSONB;
```

**API 端点**

- `/api/search/semantic?q={query}`: 语义搜索
- `/api/posts/{id}/similar`: 获取相似文章

**验收标准**

- ✅ 搜索结果相关性 > 传统关键词搜索
- ✅ 相似内容推荐准确度 > 70%

---

#### 3.2 情感分析与情绪追踪

**功能描述**
分析内容的情感基调（积极/消极/中性），并生成情绪变化曲线图。

**可视化展示**

- 后台统计页面显示情绪趋势图（折线图）
- X 轴：时间
- Y 轴：情感得分（-1 到 +1）

**技术实现**

- AI 服务返回情感得分
- 存储在新表 `ContentEmotion`

---

## 🏗️ 系统架构

### 整体架构图

```
┌─────────────────────────────────────────────┐
│          主博客系统 (Next.js)                │
│  - 用户界面                                  │
│  - 内容管理                                  │
│  - 数据存储 (PostgreSQL)                     │
└──────────────┬──────────────────────────────┘
               │ REST API 调用
               ▼
┌─────────────────────────────────────────────┐
│       AI 服务 (独立服务)                     │
│  - API 端点 (/api/*)                        │
│  - Worker 定时任务                           │
│  - ML 模型集成                               │
│    - DeepSeek API                           │
│    - 向量化模型                              │
└──────────────┬──────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────┐
│       外部 AI 服务                           │
│  - DeepSeek API                             │
│  - OpenAI Embeddings (可选)                 │
└─────────────────────────────────────────────┘
```

### AI 服务技术栈

**推荐技术栈**:

- **运行时**: Node.js (Next.js API Routes) 或 Python (FastAPI)
- **部署**: Vercel Edge Functions（轻量任务）或独立服务器（重度任务）
- **队列**: Redis + Bull.js（处理异步生成任务）
- **调度**: Vercel Cron Jobs 或 GitHub Actions

**为什么独立部署？**

1. **稳定性隔离**: AI 服务故障不影响主站
2. **性能优化**: 独立扩展 AI 服务资源
3. **成本控制**: 按需启动/停止，避免主站部署费用增加
4. **灵活迁移**: 可随时切换 AI 服务提供商

---

## 💰 成本估算

### DeepSeek API 定价（2025 年参考）

| 服务                | 输入价格          | 输出价格         | 适用场景       |
| ------------------- | ----------------- | ---------------- | -------------- |
| DeepSeek Chat       | ¥0.001/1K tokens  | ¥0.002/1K tokens | 文章生成、续写 |
| DeepSeek Embeddings | ¥0.0001/1K tokens | -                | 向量化搜索     |

**月度预算估算**（基于个人博客，假设每周生成 5 篇内容）:

- 周回顾生成：4 次/月 × 2000 tokens/次 × ¥0.002 = ¥0.016
- 主题发现：4 次/月 × 1000 tokens/次 × ¥0.001 = ¥0.004
- 智能续写：20 次/月 × 500 tokens/次 × ¥0.001 = ¥0.01
- 向量化（一次性）：100 篇 × 500 tokens × ¥0.0001 = ¥0.005

**总计：< ¥0.05/月**（约 $0.007 USD）

---

## 📊 成功指标 (KPIs)

### 产品指标

| 指标              | 目标值             | 衡量方法                      |
| ----------------- | ------------------ | ----------------------------- |
| AI 生成文章采纳率 | > 60%              | 发布的 AI 草稿 / 总生成草稿   |
| 写作时间节省      | > 50%              | 对比 AI 辅助前后平均耗时      |
| 主题发现准确率    | > 75%              | 用户认为有价值的建议 / 总建议 |
| 关系图谱使用率    | > 30% 用户每月访问 | 独立访客 / 总用户             |

### 技术指标

| 指标               | 目标值  |
| ------------------ | ------- |
| API 响应时间 (P95) | < 10s   |
| 定时任务成功率     | > 99%   |
| AI 服务可用性      | > 99.5% |

---

## 🗓️ 开发路线图

### Milestone 1: 基础设施 (2 周)

- [ ] 创建独立 AI 服务仓库
- [ ] 集成 DeepSeek API
- [ ] 实现碎片聚合 API (`/api/fragments`)
- [ ] 数据库添加向量化字段

### Milestone 2: 核心功能 (4 周)

- [ ] 时间线自动成文 (1 周)
- [ ] 主题发现引擎 (1 周)
- [ ] AI 智能续写 (1 周)
- [ ] 碎片智能重组 (1 周)

### Milestone 3: 可视化与自动化 (3 周)

- [ ] 内容关系图谱 (2 周)
- [ ] 定时任务与通知系统 (1 周)

### Milestone 4: 优化与扩展 (持续)

- [ ] 语义搜索
- [ ] 情感分析
- [ ] 性能优化

---

## 🔒 风险与挑战

### 技术风险

| 风险           | 影响 | 缓解措施                    |
| -------------- | ---- | --------------------------- |
| AI 服务不稳定  | 高   | 实现重试机制 + 降级策略     |
| 成本超预算     | 中   | 设置月度配额上限 + 监控告警 |
| 向量化性能瓶颈 | 低   | 批处理 + 缓存策略           |

### 产品风险

| 风险            | 影响 | 缓解措施                       |
| --------------- | ---- | ------------------------------ |
| AI 生成质量不佳 | 高   | 保留人工审核环节 + Prompt 优化 |
| 用户不信任 AI   | 中   | 明确标注 AI 生成 + 透明化流程  |

---

## 📚 参考资料

### API 文档

- [DeepSeek API 文档](https://platform.deepseek.com/docs)
- [OpenAI Embeddings API](https://platform.openai.com/docs/guides/embeddings)

### 技术选型

- **向量数据库**: PostgreSQL + pgvector 或 Pinecone
- **任务队列**: Bull.js + Redis
- **可视化库**: Three.js (3D) / D3.js (2D) / React Flow (2D 简化版)

---

## ✅ 验收清单

### Phase 1 完成标准

- [ ] 可以生成周回顾文章
- [ ] 后台显示主题发现建议
- [ ] 写作时可获取 AI 续写建议
- [ ] 旅行日记自动生成功能可用
- [ ] 所有 API 响应时间 < 10s

### Phase 2 完成标准

- [ ] 定时任务准时触发
- [ ] 用户收到回顾文章通知
- [ ] 后台可查看生成的草稿列表

### Phase 3 完成标准

- [ ] 语义搜索可用
- [ ] 文章底部显示相似推荐
- [ ] 情绪趋势图可视化

---

## 🤝 协作流程

### 开发流程

1. **需求确认**: 与产品经理（用户）确认具体功能细节
2. **技术设计**: 编写技术方案文档
3. **开发实现**: 按 Milestone 迭代开发
4. **测试验证**: 单元测试 + 集成测试
5. **用户验收**: 邀请用户试用并收集反馈
6. **迭代优化**: 根据反馈持续改进

### 反馈机制

- 每个 Milestone 完成后进行用户验收
- 定期（每 2 周）回顾 KPI 指标
- 建立问题追踪清单（GitHub Issues）

---

## 📝 附录

### A. Prompt 工程最佳实践

1. **结构化输入**: 使用 JSON 或 Markdown 格式化输入
2. **明确角色**: 为 AI 分配具体角色（如"叙事写作助手"）
3. **示例驱动**: 提供 few-shot 示例以提升输出质量
4. **迭代优化**: 根据输出质量持续调整 Prompt

### B. 数据隐私与安全

- 所有 AI 请求不包含敏感个人信息（如邮箱、密码）
- DeepSeek API 调用使用 HTTPS 加密
- 定期审计 AI 服务日志

### C. 未来扩展方向

- 支持多用户协作写作
- AI 图片描述生成（基于 Vision 模型）
- 语音转文字 + AI 整理
- 多语言翻译（中英互译）

---

**文档结束**
如有疑问或建议，请通过 GitHub Issues 联系。
